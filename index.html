<!DOCTYPE html>

<html>
<head>
  <title>Continuity Control API Documentation</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="continuity-control-api-documentation">Continuity Control API Documentation</h1>
<p>This file is automatically generated from the code publically available on <a href="https://github.com/ContinuityControl/control_api_reference">GitHub</a>.</p>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>This is a <a href="http://www.sinatrarb.com/">Sinatra</a> application that integrates with the Control API.  Sinatra is a small Ruby web application framework that provides a DSL (domain specific language) for handling HTTP requests like <code>get</code> and <code>post</code>.  It should be easy to read even if you don’t read Sinatra’s documentation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">require</span> <span class="hljs-string">'sinatra'</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">'sinatra/reloader'</span> <span class="hljs-keyword">if</span> development?
<span class="hljs-keyword">require</span> <span class="hljs-string">'httparty'</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">'json'</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">'dotenv'</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">'byebug'</span>
Dotenv.load</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>This class uses a library called HTTParty to connect to the Control API.  All API responses are JSON.  <code>HTTParty</code> automatically detects this and parses into a Ruby object.</p>
<p>For more information, see the <a href="http://johnnunemaker.com/httparty/">HTTParty</a> website.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ControlAPI</span></span>
  <span class="hljs-keyword">include</span> HTTParty
  base_uri ENV[<span class="hljs-string">'CONTROL_API_BASE_URI'</span>]

  basic_auth ENV[<span class="hljs-string">'CONTROL_API_KEY'</span>], ENV[<span class="hljs-string">'CONTROL_API_SECRET'</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Set the ‘Content-Type’ header to ‘application/json’ to ensure that the API accepts and returns JSON. This is currently the only supported format, but this will ensure you still get JSON if the API supports XML in the future.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  headers <span class="hljs-string">'Content-Type'</span> =&gt; <span class="hljs-string">'application/json'</span>
<span class="hljs-keyword">end</span>

helpers <span class="hljs-keyword">do</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parsed_body</span></span>
    request.body.rewind
    <span class="hljs-symbol">:</span><span class="hljs-symbol">:JSON</span>.parse(request.body.read)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>The root path in this application simply provides navigation.</p>
<p><code>erb :view_name</code> renders the file in <code>views/view_name.erb</code>.  For example, this will end up rendering <code>views/root.erb</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>get <span class="hljs-string">'/'</span> <span class="hljs-keyword">do</span>
  erb <span class="hljs-symbol">:root</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="get-v1-status">GET /v1/status</h2>
<p>Check the API status.  Useful for testing authentication without knowing other information.</p>
<h3 id="example-request">Example request</h3>
<pre><code>GET /v1/status
</code></pre><h3 id="example-response">Example response</h3>
<h4 id="http-200-ok">HTTP 200 OK</h4>
<pre><code>{<span class="hljs-string">"description"</span><span class="hljs-symbol">:<span class="hljs-string">"up"</span></span>}
</code></pre><h4 id="http-401-unauthorized">HTTP 401 Unauthorized</h4>
<p>The request was not properly authenticated.</p>
<h4 id="http-500-server-error">HTTP 500 Server Error</h4>
<h3 id="response-fields">Response fields</h3>
<ul>
<li><code>description</code>: A text description of the API state.</li>
<li><code>error</code>: A text description of any error in the API call.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>get <span class="hljs-string">'/status'</span> <span class="hljs-keyword">do</span>
  status = ControlAPI.get(<span class="hljs-string">'/v1/status.json'</span>).parsed_response

  <span class="hljs-keyword">if</span> status[<span class="hljs-string">'error'</span>]
    <span class="hljs-string">"API error: <span class="hljs-subst">#{status[<span class="hljs-string">'error'</span>]}</span>"</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-string">"API status: <span class="hljs-subst">#{status[<span class="hljs-string">'description'</span>]}</span>"</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="get-v1-users">GET /v1/users</h2>
<p>Get all users, optionally filtering by emails, external employee IDs, or manager emails</p>
<h3 id="example-requests">Example requests</h3>
<pre><code>GET /v1/users
GET /v1/users?email[]=gwashington@example.com&amp;gbush@example.com
GET /v1/users?employee_id[]=<span class="hljs-number">1234</span>
GET /v1/users?manager_email[]=mwashington@example.com
</code></pre><h3 id="example-responses">Example responses</h3>
<h4 id="http-200-ok">HTTP 200 OK</h4>
<pre><code>{
  <span class="hljs-string">"users"</span>: [
    {
      <span class="hljs-regexp">//</span> Content from GET /v1/users/<span class="hljs-symbol">:email</span>
      <span class="hljs-string">'email'</span>: <span class="hljs-string">'gwashington@example.com'</span>,
      ...
    },
    {
      <span class="hljs-string">'email'</span>: gbush@example.com<span class="hljs-string">',
      ...
    }
  ]
}</span>
</code></pre><h4 id="http-500-server-error">HTTP 500 Server Error</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>
get <span class="hljs-string">'/users'</span> <span class="hljs-keyword">do</span>
  users = ControlAPI.get(<span class="hljs-string">'/v1/users'</span>, <span class="hljs-symbol">query:</span> params)

  erb <span class="hljs-symbol">:<span class="hljs-string">'users/index'</span></span>, <span class="hljs-symbol">locals:</span> users.to_h
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="post-v1-users">POST /v1/users</h2>
<p>Create a new user and send an invitation for setting password, etc.</p>
<h3 id="example-requests">Example requests</h3>
<pre><code>POST /v1/users
Content-<span class="hljs-symbol">Type:</span> application/json

{
  <span class="hljs-string">"user"</span>: {
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"abe@whitehouse.gov"</span>,
    <span class="hljs-string">"first_name"</span>: <span class="hljs-string">"Abraham"</span>,
    <span class="hljs-string">"last_name"</span>: <span class="hljs-string">"Lincoln"</span>
  }
}
</code></pre><h3 id="request-fields">Request fields</h3>
<p>The following fields are allowed:</p>
<ul>
<li><code>email</code>: <strong>Required</strong></li>
<li><code>first_name</code>: <strong>Required</strong></li>
<li><code>last_name</code>: <strong>Required</strong></li>
<li><code>manager_email</code></li>
<li><code>title</code></li>
<li><code>employee_id</code></li>
<li><code>review_on</code></li>
<li><code>started_on</code></li>
</ul>
<p>For field descriptions, please see <code>GET /v1/users/:email</code>.</p>
<h3 id="example-responses">Example responses</h3>
<h4 id="http-200-ok">HTTP 200 OK</h4>
<p>Refer to <code>GET /v1/users/:email</code> response.</p>
<h4 id="http-422-unprocessable-entity">HTTP 422 Unprocessable Entity</h4>
<pre><code>{
  <span class="hljs-string">"errors"</span>: {
    <span class="hljs-string">"email"</span>: [
      <span class="hljs-string">"is invalid"</span>,
    ]
  }
}
</code></pre><h4 id="http-500-server-error">HTTP 500 Server Error</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>
get <span class="hljs-string">'/users/new'</span> <span class="hljs-keyword">do</span>
  erb <span class="hljs-symbol">:<span class="hljs-string">'users/new'</span></span>
<span class="hljs-keyword">end</span>

post <span class="hljs-string">'/users'</span> <span class="hljs-keyword">do</span>
  user = ControlAPI.post(<span class="hljs-string">'/v1/users'</span>, <span class="hljs-symbol">body:</span> params.to_json)

  <span class="hljs-keyword">case</span> user.response.code
  <span class="hljs-keyword">when</span> <span class="hljs-string">'201'</span>
    [<span class="hljs-number">200</span>, erb(<span class="hljs-symbol">:<span class="hljs-string">'users/created'</span></span>, <span class="hljs-symbol">locals:</span> { <span class="hljs-symbol">email:</span> user[<span class="hljs-string">'email'</span>] })]
  <span class="hljs-keyword">when</span> <span class="hljs-string">'422'</span>
    [<span class="hljs-number">422</span>, erb(<span class="hljs-symbol">:errors</span>, <span class="hljs-symbol">locals:</span> { <span class="hljs-symbol">errors:</span> user[<span class="hljs-string">'errors'</span>] })]
  <span class="hljs-keyword">else</span>
    [<span class="hljs-number">500</span>, <span class="hljs-string">'There was an error while processing your request'</span>]
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="get-v1-users-email">GET /v1/users/:email</h2>
<p>Get an individual user by their email</p>
<h4 id="data-example">Data Example</h4>
<pre><code>{
  <span class="hljs-string">"path"</span>: <span class="hljs-string">"/v1/users/gwashington@example.com"</span>,
  <span class="hljs-string">"email"</span>: <span class="hljs-string">"gwashington@example.com"</span>,
  <span class="hljs-string">"first_name"</span>: <span class="hljs-string">"George"</span>,
  <span class="hljs-string">"last_name"</span>: <span class="hljs-string">"Washington"</span>,
  <span class="hljs-string">"created_at"</span>: <span class="hljs-string">"1732-02-22T12:34:56Z"</span>,
  <span class="hljs-string">"updated_at"</span>: <span class="hljs-string">"1799-12-14T12:34:56Z"</span>,
  <span class="hljs-string">"review_on"</span>: <span class="hljs-string">"2076-07-04"</span>,
  <span class="hljs-string">"started_on"</span>: <span class="hljs-string">"1789-04-30"</span>,
  <span class="hljs-string">"manager_path"</span>: <span class="hljs-string">"/v1/users/mwashington@example.com"</span>,
  <span class="hljs-string">"manager_email"</span>: <span class="hljs-string">"mwashington@example.com"</span>,
  <span class="hljs-string">"title"</span>: <span class="hljs-string">"President of the United States"</span>,
  <span class="hljs-string">"administrator"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"employee_id"</span>: <span class="hljs-string">"1"</span>,
}
</code></pre><h4 id="data-fields">Data Fields</h4>
<ul>
<li><code>path</code>: API path for this user</li>
<li><code>email</code>: Primary email</li>
<li><code>first_name</code>: Personal name</li>
<li><code>last_name</code>: Surname</li>
<li><code>created_at</code>: ISO8601 datetime of the creation of this user, in UTC</li>
<li><code>updated_at</code>: ISO8601 datetime of the time at which this user was updated, in UTC</li>
<li><code>review_on</code>: The ISO8601 date for the next review of this user</li>
<li><code>started_on</code>: The ISO8601 date when this user’s employment started</li>
<li><code>manager_path</code>: The API path for the user’s manager</li>
<li><code>manager_email</code>: The email address of the user’s manager</li>
<li><code>title</code>: The job title of the user</li>
<li><code>administrator</code>: Whether or not the user has administrator access for their organization</li>
<li><code>employee_id</code>: (string) This is the external employee ID of the user. The value is arbitrary and is assigned by their organization. However, it must be unique to their organization.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>

get <span class="hljs-string">'/users/:email'</span> <span class="hljs-keyword">do</span>
  user = ControlAPI.get(<span class="hljs-string">"/v1/users/<span class="hljs-subst">#{params[<span class="hljs-symbol">:email</span>]}</span>"</span>)

  <span class="hljs-keyword">case</span> user.response.code
  <span class="hljs-keyword">when</span> <span class="hljs-string">'200'</span>
    erb <span class="hljs-symbol">:<span class="hljs-string">'users/show'</span></span>, <span class="hljs-symbol">locals:</span> user.to_h
  <span class="hljs-keyword">when</span> <span class="hljs-string">'404'</span>
    [<span class="hljs-number">404</span>, <span class="hljs-string">'Not found'</span>]
  <span class="hljs-keyword">else</span>
    [<span class="hljs-number">500</span>, <span class="hljs-string">'There was an error while processing your request'</span>]
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="patch-v1-users">PATCH /v1/users</h2>
<p>Updates a user.  Note that changing a user’s email address will affect their identification in other API calls, as well as the email they use to log in.</p>
<h3 id="example-requests">Example requests</h3>
<p>Refer to <code>POST /v1/users</code> request.  NOTE: you can omit keys as necessary</p>
<h3 id="example-responses">Example responses</h3>
<p>Refer to <code>GET /v1/users/:email</code> response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
get <span class="hljs-string">'/users/:email/edit'</span> <span class="hljs-keyword">do</span>
  user = ControlAPI.get(<span class="hljs-string">"/v1/users/<span class="hljs-subst">#{params[<span class="hljs-symbol">:email</span>]}</span>"</span>)
  erb <span class="hljs-symbol">:<span class="hljs-string">'users/edit'</span></span>, <span class="hljs-symbol">locals:</span> user.to_h
<span class="hljs-keyword">end</span>

post <span class="hljs-string">'/users/:email'</span> <span class="hljs-keyword">do</span>
  user = ControlAPI.patch(<span class="hljs-string">"/v1/users/<span class="hljs-subst">#{params[<span class="hljs-symbol">:email</span>]}</span>"</span>, <span class="hljs-symbol">body:</span> params.to_json)

  <span class="hljs-keyword">case</span> user.response.code
  <span class="hljs-keyword">when</span> <span class="hljs-string">'200'</span>
    erb <span class="hljs-symbol">:<span class="hljs-string">'users/show'</span></span>, <span class="hljs-symbol">locals:</span> user.to_h
  <span class="hljs-keyword">when</span> <span class="hljs-string">'422'</span>
    [<span class="hljs-number">422</span>, erb(<span class="hljs-symbol">:errors</span>, <span class="hljs-symbol">locals:</span> { <span class="hljs-symbol">errors:</span> user[<span class="hljs-string">'errors'</span>] })]
  <span class="hljs-keyword">when</span> <span class="hljs-string">'404'</span>
    [<span class="hljs-number">404</span>, <span class="hljs-string">'Not found'</span>]
  <span class="hljs-keyword">else</span>
    [<span class="hljs-number">500</span>, <span class="hljs-string">'There was an error while processing your request'</span>]
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="delete-v1-users-email">DELETE /v1/users/:email</h2>
<p>“Soft delete” the user by disabling them.  Associated records, such as completed ToDos, are not deleted.</p>
<h3 id="example-responses">Example responses</h3>
<h4 id="http-204-no-content">HTTP 204 No Content</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>post <span class="hljs-string">'/users/:email/delete'</span> <span class="hljs-keyword">do</span>
  user = ControlAPI.delete(<span class="hljs-string">"/v1/users/<span class="hljs-subst">#{params[<span class="hljs-symbol">:email</span>]}</span>"</span>)

  <span class="hljs-keyword">case</span> user.response.code
  <span class="hljs-keyword">when</span> <span class="hljs-string">'204'</span>
    [<span class="hljs-number">200</span>, erb(<span class="hljs-symbol">:<span class="hljs-string">'users/deleted'</span></span>)]
  <span class="hljs-keyword">when</span> <span class="hljs-string">'422'</span>
    [<span class="hljs-number">422</span>, erb(<span class="hljs-symbol">:errors</span>, <span class="hljs-symbol">locals:</span> { <span class="hljs-symbol">errors:</span> user[<span class="hljs-string">'errors'</span>] })]
  <span class="hljs-keyword">when</span> <span class="hljs-string">'404'</span>
    [<span class="hljs-number">404</span>, <span class="hljs-string">'Not found'</span>]
  <span class="hljs-keyword">else</span>
    [<span class="hljs-number">500</span>, <span class="hljs-string">'There was an error while processing your request'</span>]
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h2 id="get-v1-template_to_dos">GET /v1/template_to_dos</h2>
<p>Get all the TemplateToDos for your organization.  NOTE: not filtered by enabled/disabled state.</p>
<h3 id="example-requests">Example requests</h3>
<pre><code>GET /v1/template_to_dos <span class="hljs-comment">#     GET /v1/template_to_dos?tags[]=annual&amp;tags[]=security</span>
</code></pre><h3 id="request-fields">Request fields</h3>
<ul>
<li><code>tags</code>: Only return TemplateToDos that are tagged with all of the specified tags.</li>
</ul>
<h3 id="example-response">Example response</h3>
<h4 id="http-200-ok">HTTP 200 OK</h4>
<pre><code>{
  <span class="hljs-string">"template_to_dos"</span>: [
    {
      <span class="hljs-string">"uuid"</span>: <span class="hljs-string">"12345678-1234-5678-1234-567812345678"</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"Review server logs"</span>,
      <span class="hljs-string">"tags"</span>: [<span class="hljs-string">"security"</span>, <span class="hljs-string">"annual"</span>, <span class="hljs-string">"training"</span>]
    }
  ]
}
</code></pre><h4 id="http-500-server-error">HTTP 500 Server Error</h4>
<h3 id="response-fields">Response fields</h3>
<ul>
<li><code>template_to_dos</code>: an Array of TemplateToDos, or an empty array <code>[]</code> if none match the given criteria<ul>
<li><code>uuid</code>: UUID for each TemplateToDo.</li>
<li><code>name</code>: The human-readable name for each ToDo.</li>
<li><code>tags</code>: The tags for each TemplateToDo, as an array of strings. If there are no tags, it will be an empty array.</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>get <span class="hljs-string">'/template_to_dos'</span> <span class="hljs-keyword">do</span>
  template_to_dos = ControlAPI.get(<span class="hljs-string">"/v1/template_to_dos"</span>, <span class="hljs-symbol">:query</span> =&gt; params)
  erb <span class="hljs-symbol">:template_to_dos</span>, <span class="hljs-symbol">:locals</span> =&gt; template_to_dos
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="post-v1-distributed_to_dos">POST /v1/distributed_to_dos</h2>
<p><strong>Asynchronously</strong> distribute a ToDo to the given assignees.  (The work happens in a job queue.)</p>
<h3 id="example-request">Example request</h3>
<pre><code>POST /v1/distributed_to_dos
Content-<span class="hljs-symbol">Type:</span> application/json

{
  <span class="hljs-string">"distributed_to_do"</span>: {
    <span class="hljs-string">"template_to_do_uuid"</span>: <span class="hljs-string">"12345678-1234-5678-1234-567812345678"</span>,
    <span class="hljs-string">"due_on"</span>: <span class="hljs-string">"2013-11-29"</span>,
    <span class="hljs-string">"assignee_emails"</span>: [<span class="hljs-string">"bobama@example.com"</span>, <span class="hljs-string">"gwbush@example.com"</span>, <span class="hljs-string">"bclinton@example.com"</span>],
    <span class="hljs-string">"field_values"</span>: {<span class="hljs-string">"field1"</span>: <span class="hljs-string">"value1"</span>, <span class="hljs-string">"field2"</span>: <span class="hljs-string">"value2"</span>},
  }
}
</code></pre><h3 id="request-fields">Request fields</h3>
<ul>
<li><code>distributed_to_do</code>: <strong>Required</strong>.  Holds parameters for the DistributedToDo.<ul>
<li><code>template_to_do_uuid</code>: <strong>Required</strong>.  The UUID for the TemplateToDo that will be distributed.  This can be found via <code>GET /v1/template_to_dos</code>, or in Continuity Control under “Settings”.</li>
<li><code>due_on</code>: <strong>Required</strong>.  ISO8601 date of when the DistributedToDo is due, in your configured Time Zone.</li>
<li><code>assignee_emails</code>: <strong>Required</strong>.  An Array of email addresses of Users that will receive the DistributedToDos.</li>
<li><code>field_values</code>: Dictionary (Object) of values to pre-fill in the DistributedToDo.  Field names are available in Continuity Control under “Settings”.</li>
</ul>
</li>
</ul>
<h3 id="example-responses">Example responses</h3>
<h4 id="http-202-accepted">HTTP 202 Accepted</h4>
<pre><code>{
  <span class="hljs-string">"uuid"</span><span class="hljs-symbol">:<span class="hljs-string">"f81d4fae-7dec-11d0-a765-00a0c91e6bf6"</span></span>,
  <span class="hljs-string">"path"</span><span class="hljs-symbol">:<span class="hljs-string">"/v1/distributed_to_dos/f81d4fae-7dec-11d0-a765-00a0c91e6bf6"</span></span>
}
</code></pre><h4 id="http-401-unauthorized">HTTP 401 Unauthorized</h4>
<p>The request was not properly authenticated.</p>
<h4 id="http-422-unprocessable-entity">HTTP 422 Unprocessable Entity</h4>
<pre><code>{
  <span class="hljs-string">"errors"</span>: {
    <span class="hljs-string">"template_to_do_uuid"</span>: [
      <span class="hljs-string">"does not exist"</span>,
    ],
    <span class="hljs-string">"assignee_emails"</span>: [
      <span class="hljs-string">"has email alice@example.com which does not exist for this organization"</span>,
      <span class="hljs-string">"has email bob@example.com which does not exist for this organization"</span>
    ],
    <span class="hljs-string">"due_on"</span>: [
      <span class="hljs-string">"could not be parsed"</span>
    ]
  }
}
</code></pre><h4 id="http-500-server-error">HTTP 500 Server Error</h4>
<h3 id="response-fields">Response fields</h3>
<ul>
<li><code>uuid</code>: A UUID for the DistributedToDo which will be created asynchronously. Please include it in any bug reports to Continuity.</li>
<li><code>path</code>: The path where the DistributedToDo will be available once created.</li>
<li><code>errors</code>: An object with one key per request field and an array of all the validation errors that apply to that field.  The exact text of the error messages <strong>is not</strong> guaranteed and may change without warning.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>get <span class="hljs-string">'/distributed_to_dos/new'</span> <span class="hljs-keyword">do</span>
  erb <span class="hljs-symbol">:distributed_to_dos_new</span>
<span class="hljs-keyword">end</span>

post <span class="hljs-string">'/distributed_to_dos'</span> <span class="hljs-keyword">do</span>
  distributed_to_do = ControlAPI.post(<span class="hljs-string">'/v1/distributed_to_dos'</span>,
                                      <span class="hljs-symbol">:body</span> =&gt; params.to_json)

  <span class="hljs-keyword">case</span> distributed_to_do.response.code
  <span class="hljs-keyword">when</span> <span class="hljs-string">'202'</span>
    [<span class="hljs-number">200</span>, erb(<span class="hljs-symbol">:distributed_to_dos_post</span>, <span class="hljs-symbol">:locals</span> =&gt; distributed_to_do)]
  <span class="hljs-keyword">when</span> <span class="hljs-string">'422'</span>
    [<span class="hljs-number">422</span>, erb(<span class="hljs-symbol">:errors</span>, <span class="hljs-symbol">:locals</span> =&gt; distributed_to_do)]
  <span class="hljs-keyword">else</span>
    [<span class="hljs-number">500</span>, <span class="hljs-string">'There was an error while processing your request'</span>]
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h2 id="get-v1-distributed_to_dos-uuid">GET /v1/distributed_to_dos/:uuid</h2>
<p>Get the current state of a distributed_to_do as found by an <code>uuid</code>.</p>
<h3 id="example-requests">Example requests</h3>
<pre><code>GET /v1/distributed_to_dos/f81d4fae-<span class="hljs-number">7</span>dec-<span class="hljs-number">11</span>d<span class="hljs-number">0</span>-a765-<span class="hljs-number">00</span>a0c91e6bf6
</code></pre><h3 id="example-response">Example response</h3>
<h4 id="http-200-ok">HTTP 200 OK</h4>
<pre><code>{
  <span class="hljs-string">"uuid"</span>: <span class="hljs-string">"f81d4fae-7dec-11d0-a765-00a0c91e6bf6"</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Review server logs"</span>,
  <span class="hljs-string">"created_at"</span>: <span class="hljs-string">"2013-11-02T12:34:46.000Z"</span>,
  <span class="hljs-string">"completed_at"</span>: null,
  <span class="hljs-string">"due_on"</span>: <span class="hljs-string">"2013-11-08"</span>,
  <span class="hljs-string">"tags"</span>: [<span class="hljs-string">"security"</span>, <span class="hljs-string">"annual"</span>, <span class="hljs-string">"training"</span>],
  <span class="hljs-string">"assignments"</span>: [
    {
      <span class="hljs-string">"email"</span>: <span class="hljs-string">"bobama@example.com"</span>,
      <span class="hljs-string">"finished_on"</span>: <span class="hljs-string">"2013-11-07"</span>,
      <span class="hljs-string">"fields"</span>: [
        {
          <span class="hljs-string">"uuid"</span>: <span class="hljs-string">"8edfc480-a174-0135-509d-1e3560338d6d"</span>,
          <span class="hljs-string">"todo_script_id"</span>: null,
          <span class="hljs-string">"label"</span>: <span class="hljs-string">"I was able to generate this report."</span>,
          <span class="hljs-string">"value"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"disabled"</span>: <span class="hljs-literal">false</span>
        }
      ]
    },
    {
      <span class="hljs-string">"email"</span>: <span class="hljs-string">"bclinton@example.com"</span>,
      <span class="hljs-string">"finished_on"</span>: null,
      <span class="hljs-string">"fields"</span>: [
        {
          <span class="hljs-string">"uuid"</span>: <span class="hljs-string">"7fcfc480-a174-0135-509d-1e3560338d6d"</span>,
          <span class="hljs-string">"todo_script_id"</span>: null,
          <span class="hljs-string">"label"</span>: <span class="hljs-string">"I was able to generate this report."</span>,
          <span class="hljs-string">"value"</span>: null,
          <span class="hljs-string">"disabled"</span>: <span class="hljs-literal">false</span>
        }
      ]
    }
  ]
}
</code></pre><h4 id="http-401-unauthorized">HTTP 401 Unauthorized</h4>
<p>The request was not properly authenticated.</p>
<h4 id="http-404-not-found">HTTP 404 Not Found</h4>
<p>Returned when the resource does not exist.  Note that after a <code>POST</code> to <code>/v1/distributed_to_dos</code> that gives a <code>202</code>, <code>/v1/distributed_to_dos/:uuid</code> would return a <code>404</code> until the resource is <strong>asynchronously</strong> created.</p>
<h4 id="http-500-server-error">HTTP 500 Server Error</h4>
<h3 id="response-fields">Response fields</h3>
<ul>
<li><code>uuid</code>: UUID for this DistributedToDo.</li>
<li><code>name</code>: The human-readable name for this DistributedToDo.</li>
<li><code>created_at</code>: ISO8601 datetime of the creation of this DistributedToDo, in UTC.</li>
<li><code>completed_at</code>: ISO8601 datetime of when the DistributedToDo was completed, in UTC.  This is when all the assignments have been finished.  May be <code>null</code>.</li>
<li><code>due_on</code>: ISO8601 date of when the DistributedToDo is due, in your configured Time Zone.</li>
<li><code>tags</code>: The tags for this DistributedToDo, as an array of strings. If there are no tags, it will be an empty array.</li>
<li><code>assignments</code>: Array<ul>
<li><code>email</code>: User email of DistributedToDo assignment</li>
<li><code>finished_on</code>: ISO8601 date on which the assignment was completed (in UTC), or <code>null</code> if not completed</li>
<li><code>fields</code>: Array<ul>
<li>“uuid”: UUID for the Field</li>
<li>“todo_script_id”: Friendly reference id for the Field,</li>
<li>“label”: The human-readable name for the Field</li>
<li>“value”: The value submitted by the assignee</li>
<li>“disabled”: Boolean, if the Field is disabled it is not visible to the assignee</li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>get <span class="hljs-string">'/distributed_to_dos/:uuid'</span> <span class="hljs-keyword">do</span>
  distributed_to_do = ControlAPI.get(<span class="hljs-string">"/v1/distributed_to_dos/<span class="hljs-subst">#{params[<span class="hljs-symbol">:uuid</span>]}</span>"</span>)

  <span class="hljs-keyword">case</span> distributed_to_do.response.code
  <span class="hljs-keyword">when</span> <span class="hljs-string">'200'</span>
    erb <span class="hljs-symbol">:distributed_to_do</span>, <span class="hljs-symbol">:locals</span> =&gt; distributed_to_do.to_h <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> this gives us locals that are keys in the distributed_to_do response</span>
  <span class="hljs-keyword">when</span> <span class="hljs-string">'404'</span>
    [<span class="hljs-number">404</span>, <span class="hljs-string">'Not found'</span>]
  <span class="hljs-keyword">else</span>
    [<span class="hljs-number">500</span>, <span class="hljs-string">'There was an error while processing your request'</span>]
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h2 id="get-v1-distributed_to_dos">GET /v1/distributed_to_dos</h2>
<p>Get all the DistributedToDos for your organization.  Each DistributedToDo in this “collection” GET request is in the same format as the “member” GET request.</p>
<h3 id="example-requests">Example requests</h3>
<pre><code>GET /v1/distributed_to_dos
GET /v1/distributed_to_dos?created_after=<span class="hljs-number">2013</span>-<span class="hljs-number">11</span>-<span class="hljs-number">02</span>
GET /v1/distributed_to_dos?created_after=<span class="hljs-number">2013</span>-<span class="hljs-number">11</span>-<span class="hljs-number">02</span>&amp;created_before=<span class="hljs-number">2013</span>-<span class="hljs-number">11</span>-<span class="hljs-number">07</span>
GET /v1/distributed_to_dos?created_before=<span class="hljs-number">2013</span>-<span class="hljs-number">11</span>-<span class="hljs-number">07</span>
GET /v1/distributed_to_dos?late=<span class="hljs-literal">true</span>
GET /v1/distributed_to_dos?complete=<span class="hljs-literal">true</span>
GET /v1/distributed_to_dos?created_after=<span class="hljs-number">2013</span>-<span class="hljs-number">11</span>-<span class="hljs-number">02</span>&amp;created_before=<span class="hljs-number">2013</span>-<span class="hljs-number">11</span>-<span class="hljs-number">07</span>&amp;late=<span class="hljs-literal">true</span>&amp;complete=<span class="hljs-literal">false</span>
GET /v1/distributed_to_dos?tags[]=annual&amp;tags[]=security
</code></pre><h3 id="request-fields">Request fields</h3>
<ul>
<li><code>created_after</code>: ISO8601 date of exclusive lower bound of <code>created_at</code> time.</li>
<li><code>created_before</code>: ISO8601 date of exclusive upper bound of <code>created_at</code> time.</li>
<li><code>late</code>: When <code>true</code>, respond with only “late” DistributedToDos.  When <code>false</code>, respond with only “on time” DistributedToDos.  When not present, do not filter on lateness.</li>
<li><code>complete</code>: When <code>true</code>, respond with only “complete” DistributedToDos.  When <code>false</code>, respond with only “incomplete” DistributedToDos.  When not present, do not filter on completeness.</li>
<li><code>tags</code>: Only return DistributedToDos that are tagged with all of the specified tags.</li>
</ul>
<p><code>late</code> and <code>complete</code> can be combined to filter:</p>
<pre><code>late=<span class="hljs-literal">false</span>&amp;complete=<span class="hljs-literal">false</span>  <span class="hljs-comment"># incomplete and on time</span>
late=<span class="hljs-literal">false</span>&amp;complete=<span class="hljs-literal">true</span>   <span class="hljs-comment"># completed and on time</span>
late=<span class="hljs-literal">true</span>&amp;complete=<span class="hljs-literal">false</span>   <span class="hljs-comment"># incomplete and late (what most users will want)</span>
late=<span class="hljs-literal">true</span>&amp;complete=<span class="hljs-literal">true</span>    <span class="hljs-comment"># completed and late</span>
</code></pre><h3 id="example-response">Example response</h3>
<h4 id="http-200-ok">HTTP 200 OK</h4>
<pre><code>{
  <span class="hljs-string">"distributed_to_dos"</span>: [
    <span class="hljs-regexp">//</span> Content from GET /v1/distributed_to_dos/<span class="hljs-symbol">:uuid</span>
  ]
}
</code></pre><h4 id="http-500-server-error">HTTP 500 Server Error</h4>
<h3 id="response-fields">Response fields</h3>
<ul>
<li><code>distributed_to_dos</code>: an Array of DistributedToDos, or an empty array <code>[]</code> if none match the given criteria</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>get <span class="hljs-string">'/distributed_to_dos'</span> <span class="hljs-keyword">do</span>
  one_week_ago_params = { <span class="hljs-symbol">:created_after</span> =&gt; Date.today - <span class="hljs-number">7</span> }
  filter_params = params.empty? ? one_week_ago_params : params

  distributed_to_dos = ControlAPI.get(<span class="hljs-string">'/v1/distributed_to_dos'</span>, <span class="hljs-symbol">:query</span> =&gt; filter_params)
  erb <span class="hljs-symbol">:distributed_to_dos</span>, <span class="hljs-symbol">:locals</span> =&gt; distributed_to_dos
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2 id="webhooks">Webhooks</h2>
<p>Webhooks provide information about events in near real-time.  You provide a URL, and we’ll <code>POST</code> to it as events take place.  When a <code>HTTP 5XX</code> response occurs, the Webhook is retried with an incremental backoff.</p>
<h3 id="format">Format</h3>
<p>Our webhooks have the following format:</p>
<pre><code>{

  <span class="hljs-string">"event"</span>: <span class="hljs-string">"EventName"</span>,
  <span class="hljs-string">"fired_at"</span>: <span class="hljs-string">"2014-06-24T15:32:05Z"</span>,
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-regexp">//</span> Depends on event, see below
  }
}
</code></pre><h4 id="fields">Fields</h4>
<ul>
<li><code>event</code>: A named event, as documented below</li>
<li><code>fired_at</code>: When the webhook was fired</li>
<li><code>data</code>: an Object of data for the given event</li>
</ul>
<h3 id="implementation-requirements">Implementation Requirements</h3>
<p>The receiver of a webhook <strong>MUST</strong> check <code>event</code> on each <code>POST</code>.  An unknown <code>event</code> <strong>MUST</strong> be ignored.</p>
<p>Examples of why this behavior is required:</p>
<ul>
<li>If the <code>event</code> is not checked, and the receiver only looks at the <code>data.name</code> attribute, it could be a ToDo’s name instead of a user’s name.</li>
<li>If the <code>event</code> is not checked, a user could have been updated instead of created.  The receiver could then take action on an “updated” event that was only intended for a “created” event (e.g., sending a welcome email).</li>
</ul>
<h3 id="example">Example</h3>
<p>For a contrived example, if there were a <code>VoteCast</code> event, the webhook would provide data like the following in two separate <code>POST</code>s:</p>
<p>First <code>POST</code>:</p>
<pre><code>{
  <span class="hljs-string">"event"</span>: <span class="hljs-string">"VoteCast"</span>,
  <span class="hljs-string">"fired_at"</span>: <span class="hljs-string">"2000-11-07T15:32:05Z"</span>,
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"full_name"</span>: <span class="hljs-string">"Al Gore"</span>,
    <span class="hljs-string">"party"</span>: <span class="hljs-string">"Democrat"</span>
  }
}
</code></pre><p>Second <code>POST</code>:</p>
<pre><code>{
  <span class="hljs-string">"event"</span>: <span class="hljs-string">"VoteCast"</span>,
  <span class="hljs-string">"fired_at"</span>: <span class="hljs-string">"2000-11-07T15:42:05Z"</span>,
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"full_name"</span>: <span class="hljs-string">"George W Bush"</span>,
    <span class="hljs-string">"party"</span>: <span class="hljs-string">"Republican"</span>
  }
}
</code></pre><h2 id="events">Events</h2>
<h3 id="usercreated">UserCreated</h3>
<p>The <code>UserCreated</code> event fires when a new user is created on Control.</p>
<h4 id="data-example">Data Example</h4>
<pre><code>{
  <span class="hljs-string">"full_name"</span>: <span class="hljs-string">"George Washington"</span>,
  <span class="hljs-string">"first_name"</span>: <span class="hljs-string">"George"</span>,
  <span class="hljs-string">"last_name"</span>: <span class="hljs-string">"Washington"</span>,
  <span class="hljs-string">"email"</span>: <span class="hljs-string">"gwashington@example.com"</span>
}
</code></pre><h4 id="data-fields">Data Fields</h4>
<ul>
<li><code>full_name</code>: Formatted name, may be <code>null</code></li>
<li><code>first_name</code>: Personal name, may be <code>null</code></li>
<li><code>last_name</code>: Surname, may be <code>null</code></li>
<li><code>email</code>: Primary email</li>
</ul>
<h3 id="distributedtodocompleted">DistributedToDoCompleted</h3>
<p>The <code>DistributedToDoCompleted</code> events fires when all the assignments of a ToDo are completed.  That is, when the ToDo as a whole is completed, rather than an individual user’s assignment.</p>
<p>The data is the same for <code>GET /v1/distributed_to_dos/:uuid</code>.  Please refer to its documentation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>post <span class="hljs-string">'/webhook'</span> <span class="hljs-keyword">do</span>
  event = parsed_body[<span class="hljs-string">'event'</span>]
  data = parsed_body[<span class="hljs-string">'data'</span>]

  <span class="hljs-keyword">case</span> event
  <span class="hljs-keyword">when</span> <span class="hljs-string">'DistributedToDoCompleted'</span>
    <span class="hljs-string">"Good job, team!  We completed the <span class="hljs-subst">#{data[<span class="hljs-string">'name'</span>]}</span> ToDo!"</span>
  <span class="hljs-keyword">when</span> <span class="hljs-string">'UserCreated'</span>
    <span class="hljs-string">"Nice to meet you, <span class="hljs-subst">#{data[<span class="hljs-string">'full_name'</span>]}</span>!"</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
